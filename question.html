<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>The Question</title>
  <script defer src="audio-player.js"></script>
  <style>
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      overflow:hidden;
      font-family:"Trebuchet MS", system-ui, sans-serif;
      color:#4a2446;
      background:
        radial-gradient(650px 500px at 15% 10%, #ffd6ec8f, transparent 62%),
        radial-gradient(700px 540px at 90% 20%, #caecff99, transparent 62%),
        radial-gradient(680px 500px at 50% 100%, #fff1a9a1, transparent 65%),
        linear-gradient(145deg,#fff8fc,#fff2fa 45%,#f7fdff);
    }
    canvas#fx{ position:fixed; inset:0; width:100%; height:100%; pointer-events:none; z-index:1; }
    .heartLayer{ position:fixed; inset:0; z-index:2; pointer-events:none; overflow:hidden; }
    .floatHeart{
      position:absolute;
      top:-10vh;
      font-size: clamp(24px, 3vw, 40px);
      animation: driftDown linear forwards;
      will-change: transform;
      filter: drop-shadow(0 3px 5px rgba(255,92,162,.25));
      opacity:.95;
    }
    @keyframes driftDown{
      to{ transform: translate3d(var(--dx), 112vh, 0) rotate(var(--rot)); opacity:.12; }
    }

    .stickerLayer{ position:fixed; inset:0; z-index:2; pointer-events:none; }
    .sticker{ position:absolute; font-size: clamp(34px, 4.5vw, 65px); opacity:.95; will-change: transform; filter: drop-shadow(0 8px 14px rgba(255,120,170,.25)); }

    .wrap{ position:relative; z-index:3; min-height:100%; display:grid; place-items:center; padding:22px; }
    .card{
      width:min(1040px, 95vw);
      background:linear-gradient(180deg, rgba(255,255,255,.86), rgba(255,255,255,.72));
      border:2px dashed #ff9dcc;
      border-radius:32px;
      padding:24px;
      box-shadow:0 20px 50px rgba(213,74,146,.23);
      backdrop-filter: blur(10px);
    }
    h1{ margin:0 0 8px; font-size:clamp(28px,4.8vw,56px); }
    p{ margin:0; font-size:clamp(16px,2.1vw,20px); }

    .layout{ margin-top:15px; display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    @media (max-width: 900px){ .layout{ grid-template-columns:1fr; } }

    .stage{
      min-height:360px;
      border-radius:26px;
      border:1px solid #ffc0df;
      background:linear-gradient(180deg,#fff8fcbb,#ffffff99);
      box-shadow:0 14px 34px rgba(208,90,151,.2);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .note{ display:inline-block; background:white; border-radius:16px; padding:12px 14px; box-shadow:0 10px 20px #fcb7d65e; }
    .noteTitle{ font-weight:900; }
    .noteBody{ margin-top:6px; }

    .question{ margin-top:16px; font-size: clamp(34px,5vw,62px); font-weight:900; line-height:1; max-width:12ch; }
    .actions{ margin-top:16px; min-height:58px; position:relative; }
    .btn{
      border:0; cursor:pointer; border-radius:999px; padding:12px 22px; font-size:20px; font-weight:900;
      box-shadow:0 10px 24px rgba(191,61,138,.22); transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .3s ease;
      transform-origin:center;
    }
    .btn:hover{ transform:translateY(-4px) scale(1.06); box-shadow:0 16px 30px rgba(191,61,138,.3); }
    .yes{ background:linear-gradient(135deg,#ffbde0,#a8e7ff); color:#5b1f4e; }
    .no{ background:#fff; margin-left:10px; color:#5b1f4e; }
    .no.flee{ position:absolute; left:var(--nx); top:var(--ny); transform:translate(-50%,-50%) rotate(var(--nr)); transition: left .24s cubic-bezier(.2,.8,.2,1), top .24s cubic-bezier(.2,.8,.2,1), transform .24s ease; }

    .roseTrail{ position:fixed; z-index:6; pointer-events:none; font-size:20px; animation: riseTrail 900ms ease-out forwards; }
    @keyframes riseTrail{ to{ transform: translate3d(var(--tx), var(--ty), 0) rotate(var(--tr)); opacity:0; } }

    .mini{ margin-top:10px; font-size:14px; opacity:.8; }

    .photos{ position:relative; min-height:360px; }
    .polaroid{
      position:absolute; width:min(280px,43vw); background:#fff; border-radius:20px; padding:10px 10px 12px;
      box-shadow:0 15px 28px rgba(178,64,130,.2);
      animation: bobPhoto 6.3s cubic-bezier(.45,.08,.3,.99) infinite;
      will-change: transform;
    }
    .a{ left:2%; top:7%; --r:-10deg; transform:rotate(var(--r)); }
    .b{ right:5%; bottom:7%; --r:8deg; transform:rotate(var(--r)); animation-duration:6.9s; }
    .polaroid img{ width:100%; height:220px; object-fit:cover; border-radius:12px; display:block; }
    .cap{ text-align:center; margin-top:8px; font-weight:700; }
    @keyframes bobPhoto{
      0%,100%{ transform: translate3d(0,0,0) rotate(var(--r)); }
      50%{ transform: translate3d(0,-10px,0) rotate(calc(var(--r) + 1deg)); }
    }

    @media (prefers-reduced-motion: reduce){
      canvas,#fx,.stickerLayer{ display:none; }
      .floatHeart{ animation:none; top:auto; bottom:8vh; opacity:.9; }
    }
  </style>
</head>
<body>
  <script>
    if(localStorage.getItem("val_ok") !== "yes") window.location.href = "verify.html";
  </script>
  <canvas id="fx"></canvas>
  <div class="heartLayer" id="heartLayer"></div>
  <div class="stickerLayer" id="stickerLayer"></div>

  <div class="wrap">
    <main class="card">
      <h1>One more thing, Sayang ðŸ’˜</h1>
      <p>This time it is playful, cute, and impossible to say no to.</p>
      <div class="layout">
        <section class="stage" id="stage">
          <div class="note"><div class="noteTitle">A small confession</div><div class="noteBody" id="noteBody">You make my world calmer and brighter.</div></div>
          <div class="question" id="q">Will you be my Valentine?</div>
          <div class="actions">
            <button class="btn yes" id="yes">YES ðŸ¥°</button>
            <button class="btn no" id="no">No</button>
          </div>
          <div class="mini" id="mini">Try pressing No... it has dramatic reactions.</div>
        </section>

        <section class="photos" id="photos">
          <div class="polaroid a" id="phA"><img src="photos/3.jpeg" alt="Her beautiful photo" /><div class="cap">Your smile still melts me every time ðŸ’–</div></div>
          <div class="polaroid b" id="phB"><img src="photos/4.jpeg" alt="My photo" /><div class="cap">Me, still falling for you more each day ðŸ’˜</div></div>
        </section>
      </div>
    </main>
  </div>

  <script>
    const stage = document.getElementById('stage');
    const yes = document.getElementById('yes');
    const no = document.getElementById('no');
    const noteBody = document.getElementById('noteBody');
    const mini = document.getElementById('mini');

    const heartLayer = document.getElementById('heartLayer');
    const heartIcons = ['â¤','â™¥','â£','ðŸ’–','ðŸ’˜','ðŸ’•'];
    function spawnFloatHeart(){
      const h = document.createElement('span');
      h.className = 'floatHeart';
      h.textContent = heartIcons[(Math.random() * heartIcons.length) | 0];
      h.style.left = `${Math.random() * 100}%`;
      h.style.setProperty('--dx', `${(Math.random() * 100 - 50).toFixed(1)}px`);
      h.style.setProperty('--rot', `${(Math.random() * 120 - 60).toFixed(1)}deg`);
      h.style.animationDuration = `${6 + Math.random() * 4}s`;
      heartLayer.appendChild(h);
      h.addEventListener('animationend', ()=> h.remove(), { once:true });
    }
    for(let i=0;i<14;i++) setTimeout(spawnFloatHeart, i*110);
    setInterval(spawnFloatHeart, 420);

    const stickers = ['ðŸ’—','ðŸ’ž','ðŸŒ¸','ðŸŽ€','âœ¨','ðŸ«¶','ðŸ’˜','ðŸ“'];
    const layer = document.getElementById('stickerLayer');
    const movers = [];
    for(let i=0;i<10;i++){
      const el = document.createElement('div');
      el.className = 'sticker';
      el.textContent = stickers[i % stickers.length];
      layer.appendChild(el);
      movers.push({el,x:Math.random()*innerWidth,y:Math.random()*innerHeight,vx:(Math.random()*2+1)*(Math.random()>.5?1:-1),vy:(Math.random()*2+1)*(Math.random()>.5?1:-1)});
    }

    const photos=[{el:document.getElementById('phA'),x:40,y:26,vx:0.22,vy:0.18,r:-10,rr:1},{el:document.getElementById('phB'),x:260,y:125,vx:-0.2,vy:0.17,r:8,rr:-1}];

    let noCount=0;
    let yesScale=1;
    no.addEventListener('click', ()=>{
      noCount++;
      dodgeNo();
      sprinkle(20 + noCount * 8);
      if(noCount===1){ noteBody.textContent='Aww. The No button got shy and started running.'; mini.textContent='No runs away every time you tap it now.'; }
      else if(noCount===2){ noteBody.textContent='Second no?! It unlocked turbo dodge.'; mini.textContent='YES grows stronger every no ðŸ’ªðŸ’˜'; }
      else if(noCount===3){ noteBody.textContent='Okay this is funny. It is panicking in cute mode.'; mini.textContent='No is in random mode. Catch it if you can.'; }
      else { noteBody.textContent='No button says: I surrender. Please press YES ðŸ¥¹'; mini.textContent='Maximum silliness reached.'; no.textContent='still no?'; }
      yesScale = Math.min(2.6, yesScale + 0.18);
      yes.style.transform=`scale(${yesScale})`;
      yes.animate([{ transform:`scale(${yesScale - 0.08})` },{ transform:`scale(${yesScale})` }],{duration:320, easing:'cubic-bezier(.2,.8,.2,1)'});
    });

    no.addEventListener('pointerenter', ()=>{ if(noCount > 0) dodgeNo(); });

    function dodgeNo(){
      const rect=stage.getBoundingClientRect();
      const x=Math.random()*(rect.width-120)+60;
      const y=Math.random()*(rect.height-120)+70;
      no.classList.add('flee');
      no.style.setProperty('--nx',`${x}px`);
      no.style.setProperty('--ny',`${y}px`);
      no.style.setProperty('--nr',`${(Math.random()*36-18).toFixed(1)}deg`);
      makeRoseTrail(rect.left + x, rect.top + y);
    }

    function makeRoseTrail(x, y){
      const t = document.createElement('span');
      t.className = "roseTrail";
      t.textContent = Math.random() > 0.5 ? "ðŸŒ¹" : "ðŸ’–";
      t.style.left = `${x}px`;
      t.style.top = `${y}px`;
      t.style.setProperty('--tx', `${(Math.random()*50-25).toFixed(1)}px`);
      t.style.setProperty('--ty', `${(-26-Math.random()*34).toFixed(1)}px`);
      t.style.setProperty('--tr', `${(Math.random()*140-70).toFixed(1)}deg`);
      document.body.appendChild(t);
      setTimeout(()=>t.remove(), 950);
    }

    yes.addEventListener('click', ()=>{
      yes.disabled=true; no.disabled=true;
      noteBody.textContent='YESSS! initiating romantic celebration mode âœ¨';
      mini.textContent='Launching hearts, sparkles, and happy chaos.';
      burst(340);
      setTimeout(()=> window.location.href='yes.html', 1250);
    });

    const canvas=document.getElementById('fx');
    const ctx=canvas.getContext('2d',{alpha:true});
    let W,H,DPR; const rain=[]; const bursts=[];
    const rand=(a,b)=>a+Math.random()*(b-a);
    function resize(){ DPR=Math.max(1,Math.min(2,devicePixelRatio||1)); W=canvas.width=Math.floor(innerWidth*DPR); H=canvas.height=Math.floor(innerHeight*DPR); }
    addEventListener('resize',resize); resize();

    for(let i=0;i<80;i++) rain.push({x:rand(0,W),y:rand(-H,H),vx:rand(-.5,.5)*DPR,vy:rand(.9,2.3)*DPR,s:rand(9,18)*DPR,rot:rand(-1,1),vr:rand(-.03,.03),a:rand(.45,.95),c:`hsl(${rand(320,360)} 100% ${rand(62,76)}%)`});
    function sprinkle(n=40){ const r=stage.getBoundingClientRect(); for(let i=0;i<n;i++) bursts.push({x:(r.left+r.width/2+rand(-130,130))*DPR,y:(r.top+r.height/2+rand(-80,80))*DPR,vx:rand(-3,3)*DPR,vy:rand(-4,-.6)*DPR,s:rand(7,14)*DPR,rot:rand(-1,1),vr:rand(-.1,.1),a:rand(.55,1),life:rand(26,66),c:`hsl(${rand(330,30)} 100% ${rand(62,75)}%)`}); }
    function burst(n){ sprinkle(n); }

    function drawHeart(h){
      ctx.save(); ctx.translate(h.x,h.y); ctx.rotate(h.rot); ctx.fillStyle=h.c; ctx.globalAlpha=h.a;
      ctx.beginPath(); ctx.moveTo(0,h.s*.35);
      ctx.bezierCurveTo(0,0,-h.s*.5,0,-h.s*.5,h.s*.35); ctx.bezierCurveTo(-h.s*.5,h.s*.6,-h.s*.2,h.s*.85,0,h.s);
      ctx.bezierCurveTo(h.s*.2,h.s*.85,h.s*.5,h.s*.6,h.s*.5,h.s*.35); ctx.bezierCurveTo(h.s*.5,0,0,0,0,h.s*.35); ctx.fill(); ctx.restore();
    }

    (function tick(){
      ctx.clearRect(0,0,W,H);
      for(const h of rain){ h.x+=h.vx; h.y+=h.vy; h.rot+=h.vr; if(h.y>H+60){h.y=rand(-220,-40);h.x=rand(0,W);} if(h.x<-40)h.x=W+40; if(h.x>W+40)h.x=-40; drawHeart(h); }
      for(let i=bursts.length-1;i>=0;i--){ const b=bursts[i]; b.x+=b.vx; b.y+=b.vy; b.vy+=.11*DPR; b.rot+=b.vr; b.life--; b.a=Math.max(0,b.life/66); drawHeart(b); if(b.life<=0) bursts.splice(i,1); }

      for(const m of movers){
        m.x+=m.vx; m.y+=m.vy;
        if(m.x<0||m.x>innerWidth-40) m.vx*=-1;
        if(m.y<0||m.y>innerHeight-40) m.vy*=-1;
        m.el.style.transform=`translate3d(${m.x}px,${m.y}px,0)`;
      }

      const area=document.getElementById('photos').getBoundingClientRect();
      for(const p of photos){
        p.x+=p.vx; p.y+=p.vy;
        if(p.x<6||p.x>area.width-278) { p.vx*=-1; p.rr*=-1; }
        if(p.y<6||p.y>area.height-300) { p.vy*=-1; p.rr*=-1; }
        p.r += 0.06 * p.rr;
        p.el.style.left=`${p.x}px`; p.el.style.top=`${p.y}px`; p.el.style.transform=`translate3d(0,0,0) rotate(${p.r}deg)`;
      }
      requestAnimationFrame(tick);
    })();
  </script>
</body>
</html>
